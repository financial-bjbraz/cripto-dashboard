"use strict";(self.webpackChunkofb_dashboard=self.webpackChunkofb_dashboard||[]).push([[1949],{81949:function(e,t,n){n.r(t),n.d(t,{ReownAuthentication:function(){return l},ReownAuthenticationMessenger:function(){return h}});var r=n(8239),o=n(86462),s=n(72290),i=n(91951),a=n(71848),c=n(63908),u=n(71166),d=n(19579);class h{constructor(e){this.getNonce=e.getNonce}createMessage(e){var t=this;return(0,r.Z)(function*(){const n={accountAddress:e.accountAddress,chainId:e.chainId,version:"1",domain:"undefined"==typeof document?"Unknown Domain":document.location.host,uri:"undefined"==typeof document?"Unknown URI":document.location.href,resources:t.resources,nonce:yield t.getNonce(e),issuedAt:t.stringifyDate(new Date),statement:void 0,expirationTime:void 0,notBefore:void 0};return Object.assign(n,{toString:()=>t.stringify(n)})})()}stringify(e){const t=this.getNetworkName(e.chainId);return[`${e.domain} wants you to sign in with your ${t} account:`,e.accountAddress,e.statement?`\n${e.statement}\n`:"",`URI: ${e.uri}`,`Version: ${e.version}`,`Chain ID: ${e.chainId}`,`Nonce: ${e.nonce}`,e.issuedAt&&`Issued At: ${e.issuedAt}`,e.expirationTime&&`Expiration Time: ${e.expirationTime}`,e.notBefore&&`Not Before: ${e.notBefore}`,e.requestId&&`Request ID: ${e.requestId}`,e.resources?.length&&e.resources.reduce((e,t)=>`${e}\n- ${t}`,"Resources:")].filter(e=>"string"==typeof e).join("\n").trim()}getNetworkName(e){const t=c.R.getAllRequestedCaipNetworks();return d.p.getNetworkNameByCaipNetworkId(t,e)}stringifyDate(e){return e.toISOString()}}class l{constructor(e={}){this.otpUuid=null,this.listeners={sessionChanged:[]},this.localAuthStorageKey=e.localAuthStorageKey||o.uJ.SIWX_AUTH_TOKEN,this.localNonceStorageKey=e.localNonceStorageKey||o.uJ.SIWX_NONCE_TOKEN,this.required=e.required??!0,this.messenger=new h({getNonce:this.getNonce.bind(this)})}createMessage(e){var t=this;return(0,r.Z)(function*(){return t.messenger.createMessage(e)})()}addSession(e){var t=this;return(0,r.Z)(function*(){const n=yield t.request({method:"POST",key:"authenticate",body:{data:e.data,message:e.message,signature:e.signature,clientId:t.getClientId(),walletInfo:t.getWalletInfo()},headers:["nonce","otp"]});t.setStorageToken(n.token,t.localAuthStorageKey),t.emit("sessionChanged",e),t.setAppKitAccountUser(function(e){const t=e.split(".");if(3!==t.length)throw new Error("Invalid token");const n=t[1];if("string"!=typeof n)throw new Error("Invalid token");const r=n.replace(/-/gu,"+").replace(/_/gu,"/"),o=r.padEnd(r.length+(4-r.length%4)%4,"=");return JSON.parse(atob(o))}(n.token)),t.otpUuid=null})()}getSessions(e,t){var n=this;return(0,r.Z)(function*(){try{if(!n.getStorageToken(n.localAuthStorageKey))return[];const r=yield n.request({method:"GET",key:"me",query:{},headers:["auth"]});if(!r)return[];const o=r.address.toLowerCase()===t.toLowerCase(),s=r.caip2Network===e;if(!o||!s)return[];const i={data:{accountAddress:r.address,chainId:r.caip2Network},message:"",signature:""};return n.emit("sessionChanged",i),n.setAppKitAccountUser(r),[i]}catch{return[]}})()}revokeSession(e,t){var n=this;return(0,r.Z)(function*(){return Promise.resolve(n.clearStorageTokens())})()}setSessions(e){var t=this;return(0,r.Z)(function*(){if(0===e.length)t.clearStorageTokens();else{const n=e.find(e=>e.data.chainId===(0,u.eq)()?.caipNetworkId)||e[0];yield t.addSession(n)}})()}getRequired(){return this.required}getSessionAccount(){var e=this;return(0,r.Z)(function*(){if(!e.getStorageToken(e.localAuthStorageKey))throw new Error("Not authenticated");return e.request({method:"GET",key:"me",body:void 0,query:{includeAppKitAccount:!0},headers:["auth"]})})()}setSessionAccountMetadata(e=null){var t=this;return(0,r.Z)(function*(){if(!t.getStorageToken(t.localAuthStorageKey))throw new Error("Not authenticated");return t.request({method:"PUT",key:"account-metadata",body:{metadata:e},headers:["auth"]})})()}on(e,t){return this.listeners[e].push(t),()=>{this.listeners[e]=this.listeners[e].filter(e=>e!==t)}}removeAllListeners(){Object.keys(this.listeners).forEach(e=>{this.listeners[e]=[]})}requestEmailOtp({email:e,account:t}){var n=this;return(0,r.Z)(function*(){const r=yield n.request({method:"POST",key:"otp",body:{email:e,account:t}});return n.otpUuid=r.uuid,n.messenger.resources=[`email:${e}`],r})()}confirmEmailOtp({code:e}){return this.request({method:"PUT",key:"otp",body:{code:e},headers:["otp"]})}request({method:e,key:t,query:n,body:o,headers:i}){var a=this;return(0,r.Z)(function*(){const{projectId:r,st:c,sv:u}=a.getSDKProperties(),d=new URL(`${s.b.W3M_API_URL}/auth/v1/${String(t)}`);d.searchParams.set("projectId",r),d.searchParams.set("st",c),d.searchParams.set("sv",u),n&&Object.entries(n).forEach(([e,t])=>d.searchParams.set(e,String(t)));const h=yield fetch(d,{method:e,body:o?JSON.stringify(o):void 0,headers:Array.isArray(i)?i.reduce((e,t)=>{switch(t){case"nonce":e["x-nonce-jwt"]=`Bearer ${a.getStorageToken(a.localNonceStorageKey)}`;break;case"auth":e.Authorization=`Bearer ${a.getStorageToken(a.localAuthStorageKey)}`;break;case"otp":a.otpUuid&&(e["x-otp"]=a.otpUuid)}return e},{}):void 0});if(!h.ok)throw new Error(yield h.text());return h.headers.get("content-type")?.includes("application/json")?h.json():null})()}getStorageToken(e){return o.mr.getItem(e)}setStorageToken(e,t){o.mr.setItem(t,e)}clearStorageTokens(){this.otpUuid=null,o.mr.removeItem(this.localAuthStorageKey),o.mr.removeItem(this.localNonceStorageKey),this.emit("sessionChanged",void 0)}getNonce(){var e=this;return(0,r.Z)(function*(){const{nonce:t,token:n}=yield e.request({method:"GET",key:"nonce"});return e.setStorageToken(n,e.localNonceStorageKey),t})()}getClientId(){return a.L.state.clientId}getWalletInfo(){const e=c.R.getAccountData()?.connectedWalletInfo;if(!e)return;if("social"in e&&"identifier"in e)return{type:"social",social:e.social,identifier:e.identifier};const{name:t,icon:n}=e;let r="unknown";switch(e.type){case"EXTERNAL":case"INJECTED":case"ANNOUNCED":r="extension";break;case"WALLET_CONNECT":r="walletconnect";break;default:r="unknown"}return{type:r,name:t,icon:n}}getSDKProperties(){return i.Q._getSdkProperties()}emit(e,t){this.listeners[e].forEach(e=>e(t))}setAppKitAccountUser(e){const{email:t}=e;t&&Object.values(s.b.CHAIN).forEach(e=>{c.R.setAccountProp("user",{email:t},e)})}}}}]);